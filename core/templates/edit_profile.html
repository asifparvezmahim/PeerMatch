{% extends "layout.html" %}
{% load static %}

{% block content %}
<div class="animate" style="max-width: 800px; margin: 0 auto;">
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
        <h1 style="font-size: 1.8rem;">Edit <span style="color: var(--primary-color);">Profile</span></h1>
        <a href="{% url 'my_profile' %}" class="btn btn-outline">‚Üê Back to Profile</a>
    </div>

    <form method="POST" enctype="multipart/form-data">
        {% csrf_token %}

        <!-- Profile Picture -->
        <div class="glass" style="padding: 2rem; margin-bottom: 1.5rem;">
            <h3 style="color: var(--primary-color); margin-bottom: 1.25rem; font-size: 1rem;">üñºÔ∏è Profile Picture</h3>
            <div style="display: flex; align-items: center; gap: 2rem; flex-wrap: wrap;">
                <div>
                    {% if user.profile_pic %}
                    <img id="picPreview" src="{{ user.profile_pic.url }}"
                        style="width: 80px; height: 80px; border-radius: 50%; object-fit: cover; border: 3px solid var(--primary-color);">
                    {% else %}
                    <div id="picInitials"
                        style="width: 80px; height: 80px; border-radius: 50%; background: linear-gradient(135deg, var(--primary-color), var(--secondary-color)); display: flex; align-items: center; justify-content: center; font-size: 1.8rem; font-weight: 700; color: white;">
                        {{ user.name|slice:":2"|upper }}
                    </div>
                    <img id="picPreview" src=""
                        style="display: none; width: 80px; height: 80px; border-radius: 50%; object-fit: cover; border: 3px solid var(--primary-color);">
                    {% endif %}
                </div>
                <div>
                    <input type="file" name="profile_pic" id="picInput" accept="image/*" style="display: none;"
                        onchange="previewPic(this)">
                    <button type="button" class="btn btn-outline" style="margin-bottom: 0.5rem;"
                        onclick="document.getElementById('picInput').click()">Upload New Photo</button>
                    <p style="color: var(--text-muted); font-size: 0.8rem;">JPG, PNG, GIF or WebP. Max 5MB. Leave empty
                        to keep current.</p>
                </div>
            </div>
        </div>

        <!-- Basic Info -->
        <div class="glass" style="padding: 2rem; margin-bottom: 1.5rem;">
            <h3 style="color: var(--primary-color); margin-bottom: 1.25rem; font-size: 1rem;">üë§ Basic Information</h3>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                <div class="form-group">
                    <label>Full Name</label>
                    <input type="text" name="name" required value="{{ user.name }}">
                </div>
                <div class="form-group">
                    <label>Institution</label>
                    <input type="text" name="institution" value="{{ user.institution|default:'' }}">
                </div>
            </div>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                <div class="form-group">
                    <label>Research Field</label>
                    <select name="research_field">
                        {% for f in RESEARCH_FIELDS %}
                        <option value="{{ f }}" {% if user.research_field == f %}selected{% endif %}>{{ f }}
                        </option>
                        {% endfor %}
                    </select>
                </div>
                <div class="form-group">
                    <label>Interests (comma separated)</label>
                    <input type="text" name="interests" value="{{ user.interests|default:'' }}"
                        placeholder="Dark Matter, Neural Networks...">
                </div>
            </div>
        </div>

        <!-- Professional -->
        <div class="glass" style="padding: 2rem; margin-bottom: 1.5rem;">
            <h3 style="color: var(--primary-color); margin-bottom: 1.25rem; font-size: 1rem;">üíº Professional Background
            </h3>
            <div class="form-group">
                <label>Skillset (comma separated)</label>
                <input type="text" name="skillset" value="{{ user.skillset|default:'' }}"
                    placeholder="Python, MATLAB, Electron Microscopy...">
            </div>
            <div class="form-group">
                <label>Educational Background</label>
                <textarea name="education" rows="3"
                    placeholder="PhD in Physics, MIT 2020 | MSc in Applied Math, Cambridge 2016...">{{ user.education|default:'' }}</textarea>
            </div>
            <div class="form-group">
                <label>Experience</label>
                <textarea name="experience" rows="3"
                    placeholder="Positions held and research experience...">{{ user.experience|default:'' }}</textarea>
            </div>
        </div>

        <!-- Research Portfolio -->
        <div class="glass" style="padding: 2rem; margin-bottom: 1.5rem;">
            <h3 style="color: var(--secondary-color); margin-bottom: 1.25rem; font-size: 1rem;">üî¨ Research Portfolio
            </h3>
            <div class="form-group">
                <label>Previous Work &amp; Publications</label>
                <textarea name="previous_work" rows="3"
                    placeholder="Papers, projects, outcomes...">{{ user.previous_work|default:'' }}</textarea>
            </div>
            <div class="form-group">
                <label>Ongoing Work</label>
                <textarea name="ongoing_work" rows="3"
                    placeholder="What are you working on right now?">{{ user.ongoing_work|default:'' }}</textarea>
            </div>
        </div>

        <button type="submit" class="btn btn-primary" style="width: 100%; padding: 1rem; font-size: 1rem;">Save
            Profile</button>
    </form>
</div>

<script>
    function previewPic(input) {
        if (input.files && input.files[0]) {
            const reader = new FileReader();
            reader.onload = e => {
                const preview = document.getElementById('picPreview');
                const initials = document.getElementById('picInitials');
                preview.src = e.target.result;
                preview.style.display = 'block';
                if (initials) initials.style.display = 'none';
            };
            reader.readAsDataURL(input.files[0]);
        }
    }
</script>
{% endblock %}